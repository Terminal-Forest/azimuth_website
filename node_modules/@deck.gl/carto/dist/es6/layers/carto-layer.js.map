{"version":3,"sources":["../../../src/layers/carto-layer.js"],"names":["CompositeLayer","MVTLayer","getTileJSON","defaultProps","data","credentials","onDataLoad","type","value","tilejson","compare","onDataError","err","console","error","CartoLayer","initializeState","state","updateState","changeFlags","props","dataChanged","_updateData","_updateTileJSON","setState","buildMapConfig","Error","onHover","info","pickingEvent","mvtLayer","getSubLayers","renderLayers","updateTriggers","getSubLayerProps","id","layerName"],"mappings":"AAAA,SAAQA,cAAR,QAA6B,eAA7B;AACA,SAAQC,QAAR,QAAuB,qBAAvB;AACA,SAAQC,WAAR,QAA0B,wBAA1B;AAEA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,IAAI,EAAE,IADa;AAEnBC,EAAAA,WAAW,EAAE,IAFM;AAGnBC,EAAAA,UAAU,EAAE;AAACC,IAAAA,IAAI,EAAE,UAAP;AAAmBC,IAAAA,KAAK,EAAEC,QAAQ,IAAI,CAAE,CAAxC;AAA0CC,IAAAA,OAAO,EAAE;AAAnD,GAHO;AAKnBC,EAAAA,WAAW,EAAE;AAACJ,IAAAA,IAAI,EAAE,UAAP;AAAmBC,IAAAA,KAAK,EAAEI,GAAG,IAAIC,OAAO,CAACC,KAAR,CAAcF,GAAd,CAAjC;AAAqDF,IAAAA,OAAO,EAAE;AAA9D;AALM,CAArB;AAQA,eAAe,MAAMK,UAAN,SAAyBf,cAAzB,CAAwC;AACrDgB,EAAAA,eAAe,GAAG;AAChB,SAAKC,KAAL,GAAa;AACXR,MAAAA,QAAQ,EAAE;AADC,KAAb;AAGD;;AAEDS,EAAAA,WAAW,CAAC;AAACC,IAAAA;AAAD,GAAD,EAAgB;AACzB,UAAM;AAACf,MAAAA;AAAD,QAAS,KAAKgB,KAApB;;AACA,QAAID,WAAW,CAACE,WAAZ,IAA2BjB,IAA/B,EAAqC;AACnC,WAAKkB,WAAL;AACD;AACF;;AAED,QAAMA,WAAN,GAAoB;AAClB,QAAI;AACF,YAAMb,QAAQ,GAAG,MAAM,KAAKc,eAAL,EAAvB;AACA,WAAKC,QAAL,CAAc;AAACf,QAAAA;AAAD,OAAd;AACA,WAAKW,KAAL,CAAWd,UAAX,CAAsBG,QAAtB;AACD,KAJD,CAIE,OAAOG,GAAP,EAAY;AACZ,WAAKQ,KAAL,CAAWT,WAAX,CAAuBC,GAAvB;AACD;AACF;;AAEDa,EAAAA,cAAc,GAAG;AACf,UAAM,IAAIC,KAAJ,CAAU,+DAAV,CAAN;AACD;;AAED,QAAMH,eAAN,GAAwB;AACtB,UAAMd,QAAQ,GAAG,MAAMP,WAAW,CAAC,KAAKuB,cAAL,CAAoB,KAAKL,KAAzB,CAAD,EAAkC,KAAKA,KAAL,CAAWf,WAA7C,CAAlC;AACA,WAAOI,QAAP;AACD;;AAEDkB,EAAAA,OAAO,CAACC,IAAD,EAAOC,YAAP,EAAqB;AAC1B,UAAM,CAACC,QAAD,IAAa,KAAKC,YAAL,EAAnB;AACA,WAAOD,QAAQ,GAAGA,QAAQ,CAACH,OAAT,CAAiBC,IAAjB,EAAuBC,YAAvB,CAAH,GAA0C,MAAMF,OAAN,CAAcC,IAAd,EAAoBC,YAApB,CAAzD;AACD;;AAEDG,EAAAA,YAAY,GAAG;AACb,QAAI,CAAC,KAAKf,KAAL,CAAWR,QAAhB,EAA0B,OAAO,IAAP;AAE1B,UAAM;AAACwB,MAAAA;AAAD,QAAmB,KAAKb,KAA9B;AAEA,WAAO,IAAInB,QAAJ,CACL,KAAKmB,KADA,EAEL,KAAKc,gBAAL,CAAsB;AACpBC,MAAAA,EAAE,EAAE,KADgB;AAEpB/B,MAAAA,IAAI,EAAE,KAAKa,KAAL,CAAWR,QAFG;AAGpBwB,MAAAA;AAHoB,KAAtB,CAFK,CAAP;AAQD;;AAnDoD;AAsDvDlB,UAAU,CAACqB,SAAX,GAAuB,YAAvB;AACArB,UAAU,CAACZ,YAAX,GAA0BA,YAA1B","sourcesContent":["import {CompositeLayer} from '@deck.gl/core';\nimport {MVTLayer} from '@deck.gl/geo-layers';\nimport {getTileJSON} from '../api/maps-api-client';\n\nconst defaultProps = {\n  data: null,\n  credentials: null,\n  onDataLoad: {type: 'function', value: tilejson => {}, compare: false},\n  // eslint-disable-next-line\n  onDataError: {type: 'function', value: err => console.error(err), compare: false}\n};\n\nexport default class CartoLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      tilejson: null\n    };\n  }\n\n  updateState({changeFlags}) {\n    const {data} = this.props;\n    if (changeFlags.dataChanged && data) {\n      this._updateData();\n    }\n  }\n\n  async _updateData() {\n    try {\n      const tilejson = await this._updateTileJSON();\n      this.setState({tilejson});\n      this.props.onDataLoad(tilejson);\n    } catch (err) {\n      this.props.onDataError(err);\n    }\n  }\n\n  buildMapConfig() {\n    throw new Error('You must use one of the specific carto layers: BQ or SQL type');\n  }\n\n  async _updateTileJSON() {\n    const tilejson = await getTileJSON(this.buildMapConfig(this.props), this.props.credentials);\n    return tilejson;\n  }\n\n  onHover(info, pickingEvent) {\n    const [mvtLayer] = this.getSubLayers();\n    return mvtLayer ? mvtLayer.onHover(info, pickingEvent) : super.onHover(info, pickingEvent);\n  }\n\n  renderLayers() {\n    if (!this.state.tilejson) return null;\n\n    const {updateTriggers} = this.props;\n\n    return new MVTLayer(\n      this.props,\n      this.getSubLayerProps({\n        id: 'mvt',\n        data: this.state.tilejson,\n        updateTriggers\n      })\n    );\n  }\n}\n\nCartoLayer.layerName = 'CartoLayer';\nCartoLayer.defaultProps = defaultProps;\n"],"file":"carto-layer.js"}